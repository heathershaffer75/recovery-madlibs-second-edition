<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Recovery Mad Libs 2 ‚Äî Second Edition</title>
  <style>
    :root {
      --bg: #0f172a;            /* slate-900 */
      --panel: #111827;         /* gray-900 */
      --muted: #1f2937;         /* gray-800 */
      --text: #e5e7eb;          /* gray-200 */
      --sub: #94a3b8;           /* slate-400 */
      --accent: #22c55e;        /* green-500 */
      --accent-2: #38bdf8;      /* sky-400 */
      --warn: #f59e0b;          /* amber-500 */
      --danger: #ef4444;        /* red-500 */
      --card: #0b1220;          /* deep */
      --field: #0b1220;
      --chip: #0e1726;
      --shadow: 0 15px 35px rgba(0,0,0,.35), 0 5px 15px rgba(0,0,0,.25);
      --radius: 16px;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; background: radial-gradient(1200px 800px at 20% -10%, #12203a 0%, var(--bg) 40%) no-repeat,
                              radial-gradient(1200px 800px at 120% 120%, #0b1a30 0%, var(--bg) 50%) no-repeat;
      color: var(--text); font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      min-height: 100vh; display: grid; grid-template-rows: auto 1fr auto;
    }
    header {
      padding: 24px 20px; position: sticky; top: 0; z-index: 10;
      backdrop-filter: blur(8px);
      background: linear-gradient(180deg, rgba(15,23,42,.85), rgba(15,23,42,.55) 60%, rgba(15,23,42,0));
      border-bottom: 1px solid rgba(255,255,255,.06);
    }
    .container { width: min(1200px, 92vw); margin: 0 auto; }
    h1 { margin: 0 0 6px; font-size: clamp(22px, 4vw, 32px); letter-spacing: .5px; }
    .sub { color: var(--sub); font-size: 14px; }
    main { padding: 20px; }
    .grid {
      display: grid; grid-template-columns: 300px 1fr; gap: 20px;
    }
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panel { padding: 16px; }
    .story-select label { display:block; font-weight:600; margin-bottom:8px; }
    select, input[type="text"], textarea {
      width: 100%; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,.08);
      background: var(--field); color: var(--text);
      outline: none;
    }
    select { cursor: pointer; }
    .chips { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px;}
    .chip {
      background: var(--chip); border:1px solid rgba(255,255,255,.08);
      padding:6px 10px; border-radius:999px; font-size:12px; color:var(--sub);
    }
    .inputs { display: grid; gap: 12px; margin-top: 16px; }
    .input-row { display:grid; grid-template-columns: 160px 1fr auto; gap: 10px; align-items:center; }
    .input-row label { font-size: 13px; color:var(--sub); }
    .btns { display:flex; gap:10px; flex-wrap:wrap; }
    button {
      border: none; padding: 10px 14px; border-radius: 12px; cursor: pointer; font-weight: 700;
      transition: transform .05s ease, filter .2s ease; color: #0b1220;
    }
    button:active { transform: translateY(1px) scale(.99); }
    .primary { background: linear-gradient(135deg, var(--accent-2), var(--accent)); color: #08211a; }
    .ghost { background: rgba(255,255,255,.08); color: var(--text); border: 1px solid rgba(255,255,255,.08); }
    .danger { background: linear-gradient(135deg, #ef4444, #f97316); color: #fff; }
    .output { padding: 18px 18px 24px; line-height: 1.6; }
    .output h2 { margin: 8px 0 12px; }
    .output .para { background: rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.06); padding: 14px; border-radius: 12px; margin: 10px 0; }
    footer { padding: 22px; text-align:center; color: var(--sub); border-top: 1px solid rgba(255,255,255,.06); }
    .tips { font-size:12px; color:var(--sub); margin-top: 8px; }
    .flex { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .small { font-size: 12px; color: var(--sub); }
    .kbd { padding:2px 6px; border-radius:6px; background: rgba(255,255,255,.1); border:1px solid rgba(255,255,255,.15); font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 11px; }
    .story-title { font-weight:700; font-size: 18px; }
    .badge { padding:4px 8px; border-radius:999px; background:rgba(34,197,94,.15); border:1px solid rgba(34,197,94,.3); color:#9ae6b4; font-size:12px; }
    .float { position: sticky; top: 82px; }
    .helper { font-size: 12px; color: var(--sub); margin-top: 6px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <h1>Recovery Mad Libs 2 <span class="badge">Second Edition</span></h1>
      <div class="sub">Long-form, hilarious, recovery-themed Mad Libs for groups ‚Äî includes 10 stories, 3 patients + 2 staff, and lots of buzzwords.</div>
    </div>
  </header>
  <main class="container">
    <div class="grid">
      <aside class="card panel float">
        <div class="story-select">
          <label for="story">Choose a story</label>
          <select id="story"></select>
          <div class="helper">Tip: Press <span class="kbd">Tab</span> to jump between fields. Click ‚ÄúRandom Fill‚Äù for suggestions.</div>
        </div>

        <div class="panel" style="padding:0; margin-top:12px;">
          <div class="panel" style="padding:16px 16px 6px;">
            <div class="story-title" id="storyTitle">‚Äî</div>
            <div class="small" id="storyMeta"></div>
          </div>
          <div class="panel" style="padding:0 16px 16px;">
            <div class="inputs" id="inputs"></div>
            <div class="tips">Player roles are fixed: <b>Patient 1‚Äì3</b>, <b>Staff 1‚Äì2</b>. Many placeholders repeat within a story ‚Äî you only fill them once.</div>
            <div class="btns" style="margin-top:12px;">
              <button class="ghost" id="randomBtn" title="Suggest fun values for the blanks">üé≤ Random Fill</button>
              <button class="ghost" id="clearBtn">üßΩ Clear</button>
              <button class="primary" id="generateBtn">‚ö° Generate Story</button>
              <button class="danger" id="copyBtn" title="Copy the generated story once it appears">üìã Copy Output</button>
            </div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px;">
          <div class="sub" style="margin-bottom:6px;">Buzzword & Prompt Ideas</div>
          <div class="chips" id="chips"></div>
        </div>
      </aside>

      <section class="card output">
        <h2 id="outTitle">Your Story Will Appear Here</h2>
        <div id="outBody"></div>
      </section>
    </div>
  </main>
  <footer>
    Built for group rooms: copy/paste results into slides or printouts. No external libraries. ‚Äî ¬© Recovery Mad Libs 2 (Second Edition)
  </footer>

  <script>
  // ---------- Utility ----------
  const $ = (q) => document.querySelector(q);
  const h = (tag, attrs={}, ...children) => {
    const el = document.createElement(tag);
    Object.entries(attrs).forEach(([k,v]) => {
      if (k === 'class') el.className = v;
      else if (k === 'for') el.htmlFor = v;
      else el.setAttribute(k,v);
    });
    children.forEach(c => {
      if (c == null) return;
      el.appendChild(typeof c === 'string' ? document.createTextNode(c) : c);
    });
    return el;
  };
  const unique = (arr) => Array.from(new Set(arr));
  const toTitle = (s) => s.replace(/[-_]/g,' ').replace(/\b\\w/g, m => m.toUpperCase());

  // ---------- Suggestion Pools ----------
  const pools = {
    patientNames: ["Alex","Jordan","Taylor","Sam","Riley","Casey","Morgan","Blake","Quinn","Drew"],
    staffNames: ["Pat","Lee","Avery","Chris","Jamie","Cameron","Dana","Rowan"],
    buzzword: ["radical acceptance","HALT","pink cloud","sponsor call","values in action","relapse prevention plan","urge surfing","distress tolerance","CBT worksheet","accountability buddy","mindful breathing","dopamine detox","higher power","SMART goal","gratitude list","opposite action"],
    catchphrase: ["We do hard things!","Not today, chaos!","Serenity now!","Progress, not perfection!","Say less‚Äîrecover more!","Still here, still sober!","Breathe it out!"],
    funnyObject: ["emotional support stapler","glittery stress potato","therapy kazoo","rubber chicken","pocket gong","dramatic cape","mini traffic cone","foam sword"],
    pluralNoun: ["coping skills","snacks","affirmations","plush llamas","group notebooks","invisible trophies","sticky notes","wellness stickers","chair squeaks"],
    object: ["clipboard","whiteboard","yoga block","traffic cone","ring light","folding chair","extension cord","glitter jar","megaphone","paper crown"],
    animal: ["squirrel","pigeon","goose","cat","goldfish","hamster","chinchilla"],
    funnyLiquid: ["emotional espresso","sparkling pickle juice","glow-stick soup","sparkle water","unicorn latte"],
    drink: ["lukewarm coffee","electrolyte juice","mystery tea","herbal turbo tea"],
    location: ["the gift shop","the parking lot","the nurses' station","the art room","the far field","the vending machines"],
    color: ["chartreuse","mauve","electric blue","pumpkin spice","ghost white"],
    funnySong: ["Eye of the Tiger on recorder","yoga flute remix","dramatic kazoo anthem","lo-fi recovery beats"],
    food: ["anchovy cupcakes","pepperoni popsicles","pineapple pickles","broccoli brownies"],
    verbIng: ["over-explaining","power-stretching","dramatic sighing","interpretive dancing","speed-walking","micro-napping"],
    verb: ["debate","sidestep","moonwalk","murmur","power-walk","air-drum"],
    bodyPart: ["left eyebrow","right pinky toe","core","hip flexor"],
    adjective: ["chaotic","sparkly","mysterious","crispy","dizzy","zen","dramatic","mellow"],
    phrase: ["nailed it weird","growth is messy","we out here healing"],
  };

  function rand(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  // ---------- Stories (10) ----------
  // Each story has: title, meta, paragraphs (array of strings) with {{placeholders}}.
  const stories = [
    {
      key: "meditation-meltdown",
      title: "Meditation Meltdown",
      meta: "3‚Äì5 paragraphs ‚Ä¢ 3 Patients + 2 Staff ‚Ä¢ mindfulness gone sideways",
      paragraphs: [
        "The day began with high hopes for a peaceful meditation. {{patient1}} brought in a {{funny_object}}, declaring it their official ‚Äúmindfulness assistant.‚Äù {{patient2}} plopped onto a {{adjective}} yoga mat and immediately started {{verb_ing}}, while {{patient3}} whispered to the person next to them about {{plural_noun}}. {{staff1}} dimmed the lights and said, ‚ÄúLet‚Äôs just focus on our {{buzzword}},‚Äù while {{staff2}} shuffled through a pile of {{plural_noun}} that definitely didn‚Äôt look calming.",
        "The silence lasted exactly thirty seconds before {{patient1}} sneezed so loudly it made a {{animal}} outside leap into the air and crash into a {{object}}. {{patient2}} gasped, insisting this was a sign from their {{higher_power}}, while {{patient3}} began chanting ‚Äú{{catchphrase}}!‚Äù in a booming voice. {{staff1}} desperately tried to use a grounding exercise, telling everyone to name five {{plural_noun}} they could see, but all anyone could see was chaos. Meanwhile, {{staff2}} demonstrated deep breathing so aggressively that their face turned the color of {{color}}.",
        "Halfway through, {{patient2}} admitted they weren‚Äôt meditating at all‚Äîthey were mentally listing every {{plural_noun}} they regretted. {{patient1}} accused them of practicing ‚Äú{{recovery_concept}} instead of mindfulness,‚Äù and {{patient3}} announced they‚Äôd achieved enlightenment by picturing {{plural_noun}} swimming in {{funny_liquid}}. The group broke into two factions: Team Stillness with {{patient1}} and Team Chaos with {{patient3}}. {{staff1}} sighed and pulled out a {{object}} to use as a pretend gong, which only made things worse when it shattered into {{plural_noun}}.",
        "The finale came when {{staff2}} tripped over a {{funny_object}}, spilling their {{drink}} onto {{patient2}}‚Äôs journal. Everyone began clapping like this was part of the exercise, shouting ‚Äú{{catchphrase}}!‚Äù as though they‚Äôd discovered the next stage of recovery. The group ended not with peace, but with a new affirmation: ‚ÄúWhen life gives you {{plural_noun}}, inhale {{buzzword}}, exhale {{catchphrase}}.‚Äù"
      ]
    },
    {
      key: "kickball-coping",
      title: "Kickball Coping Skills",
      meta: "Outdoor chaos ‚Ä¢ coping skills in motion",
      paragraphs: [
        "Community rec time was supposed to be simple: a friendly game of kickball. {{patient1}} stepped up to the plate with a {{funny_object}} instead of a ball, while {{patient2}} stretched dramatically, yelling about their {{buzzword}}. {{patient3}} just wanted to {{verb}} instead of play, but {{staff1}} blew the whistle and declared, ‚ÄúWe are building {{recovery_concept}} today!‚Äù {{staff2}}, however, was busy writing the teams down on a {{object}} that immediately got lost under {{plural_noun}}.",
        "The game started with chaos. {{patient1}} kicked the ball so hard it flew into {{location}}, nearly colliding with a {{animal}}. {{patient2}} chased after it, shouting ‚Äú{{catchphrase}}!‚Äù while {{patient3}} tried to call a time-out because they had to {{verb}} urgently. {{staff1}} yelled, ‚ÄúUse your {{buzzword}}!‚Äù but no one seemed to know what that meant. Meanwhile, {{staff2}} tripped over {{plural_noun}} and accidentally declared {{patient2}} the MVP.",
        "Midway through the game, tensions rose. {{patient1}} accused {{patient2}} of {{verb_ing}} instead of playing fair, while {{patient3}} suggested everyone just sit in a circle and share gratitudes for {{plural_noun}}. {{staff1}} tried to enforce the rules by waving around a {{funny_object}}, but this only made {{patient2}} laugh so hard they nearly collapsed. {{staff2}} attempted to restore order with a motivational speech about {{buzzword}}, but it was drowned out by {{patient1}} shouting about {{plural_noun}}.",
        "Finally, the game ended in the most therapeutic way possible: by everyone collapsing onto the {{adjective}} grass and chanting ‚Äú{{catchphrase}}!‚Äù together. {{staff1}} declared it the best example of ‚Äúradical {{buzzword}}‚Äù they had ever seen. {{patient3}} suggested renaming the game ‚ÄúKickball Coping Skills: Extreme Edition.‚Äù Everyone agreed the real winner was whoever managed not to trip over {{plural_noun}} during the chaos."
      ]
    },
    {
      key: "gratitude-attitude",
      title: "Gratitude with Attitude",
      meta: "Circle time goes sideways ‚Ä¢ gratitude, sarcasm, and spills",
      paragraphs: [
        "The gratitude circle began with the usual seriousness. {{patient1}} said they were grateful for their {{buzzword}}, while {{patient2}} dramatically announced they were grateful for {{funny_object}}. {{patient3}} rolled their eyes and muttered something about being thankful for {{plural_noun}}. {{staff1}} smiled and reminded everyone to ‚Äúfocus on the positives,‚Äù while {{staff2}} adjusted their {{object}} and tried to look supportive.",
        "Things went sideways fast. {{patient1}} interrupted {{patient2}} to accuse them of being ‚Äúsarcastic with their gratitude,‚Äù while {{patient3}} loudly declared, ‚ÄúI‚Äôm grateful for my {{buzzword}}, not your {{adjective}} {{noun}}!‚Äù The circle erupted into laughter when {{staff1}} attempted to share their gratitude for {{plural_noun}} but mispronounced it so badly it sounded like {{phrase}}. Meanwhile, {{staff2}} passed around a {{object}} filled with {{plural_noun}} as a ‚Äúgratitude prop,‚Äù which only confused everyone more.",
        "By the middle, chaos had replaced gratitude. {{patient2}} started chanting ‚Äú{{catchphrase}}!‚Äù while waving their {{funny_object}} in the air. {{patient1}} tried to get serious again by saying they were grateful for {{recovery_concept}}, but {{patient3}} interrupted to say they were grateful for {{plural_noun}} because ‚Äúat least they don‚Äôt talk back.‚Äù {{staff1}} sighed loudly and tried to lead a breathing exercise, but {{staff2}} accidentally knocked over {{object}}, spilling {{funny_liquid}} everywhere.",
        "The circle ended with everyone listing three gratitudes: one serious, one sarcastic, and one ridiculous. {{patient1}} wrote down {{buzzword}}, {{patient2}} scribbled ‚Äú{{funny_object}},‚Äù and {{patient3}} shouted out ‚Äú{{plural_noun}}!‚Äù as their final answer. The group‚Äôs closing affirmation became: ‚ÄúIn recovery, you can be grateful for anything‚Äîeven {{funny_object}}‚Äîas long as you shout ‚Äò{{catchphrase}}!‚Äô at the end.‚Äù"
      ]
    },
    {
      key: "rap-battle",
      title: "Large Group Room Recovery Rap Battle",
      meta: "Rhymes, buzzwords, and accidental anthems",
      paragraphs: [
        "It was supposed to be a regular large group session, but {{patient1}} arrived carrying a {{funny_object}} and announced they were starting a recovery rap battle. {{patient2}} immediately jumped in, rhyming ‚Äú{{buzzword}}‚Äù with ‚Äú{{plural_noun}},‚Äù while {{patient3}} shouted that their flow was ‚Äú{{adjective}} and {{adjective}}!‚Äù {{staff1}} sighed, clutching their {{object}}, and muttered, ‚ÄúThis was not in the treatment manual.‚Äù Meanwhile, {{staff2}} looked way too excited, pulling out a {{plural_noun}} like they‚Äôd been waiting for this moment.",
        "The first round went wild. {{patient1}} dropped a verse about {{recovery_concept}}, but forgot the beat and ended up {{verb_ing}} instead. {{patient2}} responded with a line about {{plural_noun}} that had the whole room chanting ‚Äú{{catchphrase}}!‚Äù {{patient3}} tried to freestyle, but it came out sounding like a {{animal}} impression. {{staff1}} tried to call time-out, but {{staff2}} yelled ‚ÄúEncore!‚Äù and started beatboxing into a {{object}}.",
        "By round two, the chaos was unstoppable. {{patient1}} rhymed ‚Äú{{buzzword}}‚Äù with ‚Äú{{funny_object}},‚Äù which made {{patient2}} collapse in laughter. {{patient3}} tried to one-up them with a verse about {{plural_noun}} swimming in {{funny_liquid}}, while {{staff1}} buried their face in their {{object}}. {{staff2}} attempted to rap about {{buzzword}}, but accidentally rhymed it with their own {{body_part}}, causing the entire room to explode with laughter.",
        "The grand finale came when everyone, including {{staff1}}, joined in on a group chorus of ‚Äú{{catchphrase}}!‚Äù over and over until it sounded like a recovery anthem. The rap battle ended with a tie, and {{patient3}} declared, ‚ÄúThe real winner is {{buzzword}}.‚Äù The new group affirmation became: ‚ÄúWhen in doubt, rhyme it out‚Äîand always end with {{catchphrase}}!‚Äù"
      ]
    },
    {
      key: "pizza-relapse",
      title: "Pizza Party Relapse Prevention",
      meta: "Cheesy lessons ‚Ä¢ plans written on greasy napkins",
      paragraphs: [
        "The day was supposed to be special: a recovery pizza party. {{patient1}} insisted on ordering a pizza topped with {{weird_food}}, while {{patient2}} asked for extra {{plural_noun}} on theirs. {{patient3}} just wanted plain cheese, but {{staff1}} said, ‚ÄúDon‚Äôt forget‚Äîthis is also a lesson in {{buzzword}}.‚Äù {{staff2}} walked in carrying a {{funny_object}}, announcing they were the official pizza referee.",
        "The first disaster struck when {{patient1}}‚Äôs toppings arrived and looked suspiciously like {{plural_noun}}. {{patient2}} refused to eat it, shouting ‚Äú{{catchphrase}}!‚Äù loud enough to make the delivery driver trip over a {{object}}. {{patient3}} tried to calm everyone down by {{verb_ing}}, but this only caused more chaos. {{staff1}} reminded everyone about using coping skills, but {{staff2}} was too busy trying to separate slices with a {{funny_object}}.",
        "Halfway through the party, {{patient2}} declared they were making a relapse prevention plan on a greasy napkin, scribbling things like ‚Äúavoid {{plural_noun}}‚Äù and ‚Äúcall my {{buzzword}} buddy.‚Äù {{patient1}} grabbed the napkin and added, ‚ÄúStep three: eat more {{weird_food}}.‚Äù {{patient3}} insisted that the only real plan was chanting ‚Äú{{catchphrase}}!‚Äù before every bite. {{staff1}} shook their head while {{staff2}} took a victory photo holding a slice of {{adjective}} pizza above their head.",
        "The party ended in predictable chaos. The napkin relapse plan was unreadable due to {{funny_liquid}} stains, and the group decided that the best prevention skill was simply ‚ÄúDon‚Äôt trust {{patient1}}‚Äôs pizza choices.‚Äù The final affirmation became: ‚ÄúLife is like pizza‚Äîsometimes messy, always cheesy, and better when topped with {{buzzword}}.‚Äù"
      ]
    },
    {
      key: "juice-journaling",
      title: "Juice Bar Journaling",
      meta: "Smoothies + prompts + unexpected sticker awards",
      paragraphs: [
        "The new wellness initiative was called ‚ÄúJuice & Journaling.‚Äù {{patient1}} proudly ordered a smoothie made of {{weird_food}}, while {{patient2}} insisted their drink had to include {{plural_noun}}. {{patient3}} rolled their eyes and said they‚Äôd rather just have {{funny_liquid}}. {{staff1}} clapped their hands, saying, ‚ÄúGreat! Now let‚Äôs combine this with a journal prompt about {{buzzword}}.‚Äù {{staff2}} quietly adjusted their {{object}} and prepared to supervise.",
        "Things unraveled quickly when {{patient1}} spilled their {{drink}} all over {{staff2}}‚Äôs {{object}}. {{patient2}} screamed, ‚Äú{{catchphrase}}!‚Äù while trying to mop it up with {{plural_noun}}. {{patient3}} refused to participate, claiming their higher power told them not to write unless they had {{funny_object}}. {{staff1}} attempted to redirect, saying, ‚ÄúJust reflect on your {{buzzword}},‚Äù but everyone was too distracted by the sound of {{animal}} noises coming from outside.",
        "Halfway through, {{patient1}} admitted they‚Äôd written three pages about {{plural_noun}} instead of their recovery. {{patient2}} confessed they had doodled pictures of {{funny_object}} instead of journaling. {{patient3}} claimed they had finished their entire prompt by writing just two words: ‚Äú{{catchphrase}} forever.‚Äù {{staff1}} buried their face in their {{object}}, while {{staff2}} pretended to be impressed and gave everyone a sticker shaped like {{plural_noun}}.",
        "The session ended with laughter and chaos. The official group conclusion was that juice makes journals {{adjective}}, but journals make juice {{adjective}}, and no one knew what that meant. The new affirmation became: ‚ÄúWhen in doubt, mix {{buzzword}} with {{catchphrase}}, and always double-blend your {{weird_food}}.‚Äù"
      ]
    },
    {
      key: "talent-show",
      title: "Talent Show: Recovery Edition",
      meta: "Standing ovations, foam swords, and radical acceptance",
      paragraphs: [
        "The community was buzzing with excitement for the first ever Recovery Talent Show. {{patient1}} walked confidently on stage holding a {{funny_object}} and announced their talent: dramatic interpretive {{verb_ing}}. {{patient2}} followed by balancing on a {{object}} while reciting their {{buzzword}} out loud. {{patient3}} insisted they would reveal ‚Äúthe most inspiring recovery performance of all time,‚Äù which turned out to be them {{verb_ing}} while juggling {{plural_noun}}. {{staff1}} smiled nervously, holding the microphone, while {{staff2}} held a clipboard covered in {{plural_noun}} as if they were real judges.",
        "The audience roared with laughter when {{patient1}} dropped their {{funny_object}} and shouted ‚Äú{{catchphrase}}!‚Äù like it was part of the act. {{patient2}} lost balance and fell into a pile of {{plural_noun}}, but quickly recovered by claiming it was ‚Äúradical acceptance in action.‚Äù Meanwhile, {{patient3}} demanded a drumroll, but instead {{staff1}} accidentally turned on a recording of {{funny_song}}, which became the unofficial soundtrack of the night. {{staff2}} clapped enthusiastically, yelling, ‚ÄúTen out of ten for {{buzzword}}!‚Äù",
        "By intermission, chaos had become the real talent. {{patient1}} challenged {{patient2}} to a dance-off involving {{funny_object}}, while {{patient3}} argued with {{staff2}} over whether their juggling counted as a relapse prevention skill. {{staff1}} tried to keep order by waving around a {{object}}, but the crowd was too busy chanting ‚Äú{{catchphrase}}!‚Äù at the top of their lungs.",
        "The finale came when all three patients joined together in a group act called ‚Äú{{buzzword}} Unplugged,‚Äù which involved {{verb_ing}}, {{plural_noun}}, and a very confused {{animal}}. {{staff1}} declared it the most inspirational talent show since {{funny_event}}, while {{staff2}} handed out trophies made of {{plural_noun}}. The closing affirmation became: ‚ÄúIn recovery, your true talent is turning {{funny_object}} into {{buzzword}}‚Äîand doing it with style.‚Äù"
      ]
    },
    {
      key: "chair-yoga",
      title: "Chair Yoga Catastrophe",
      meta: "Calm intentions, comedic outcomes",
      paragraphs: [
        "Chair yoga was supposed to be calm and centering. {{patient1}} sat down and immediately broke a {{object}}, while {{patient2}} tried to impress everyone by balancing on one foot and chanting their {{buzzword}}. {{patient3}} was less committed, slouching in their chair while playing with a {{funny_object}}. {{staff1}} began the session with a deep breath, while {{staff2}} adjusted the chairs into a circle and tripped over {{plural_noun}}.",
        "The first move was ‚Äúreach for the sky,‚Äù but {{patient1}} stretched so far they knocked over a {{object}}, which spilled {{funny_liquid}} across the floor. {{patient2}} shouted, ‚Äú{{catchphrase}}!‚Äù as they tried to help, but instead slipped and landed in {{plural_noun}}. {{patient3}} laughed so hard they nearly fell out of their chair, while {{staff1}} desperately tried to redirect with calming affirmations. {{staff2}} clapped and said, ‚ÄúAt least we‚Äôre practicing radical {{buzzword}}!‚Äù",
        "Midway through, things got worse. {{patient1}} decided to improvise their own pose, called ‚ÄúThe Flailing {{animal}},‚Äù which caused the rest of the group to copy them. {{patient2}} attempted to do ‚ÄúDownward Recovery‚Äù but ended up {{verb_ing}} uncontrollably. {{patient3}} announced they had invented a new yoga pose called ‚Äú{{funny_object}} Warrior,‚Äù which involved waving around {{plural_noun}}. {{staff1}} muttered something about insurance liability while {{staff2}} tried to keep a straight face.",
        "The session ended in total collapse. All the chairs tipped over like dominoes, and everyone shouted ‚Äú{{catchphrase}}!‚Äù as if it were part of the program. The final affirmation became: ‚ÄúIn recovery yoga, it‚Äôs not about the perfect pose‚Äîit‚Äôs about laughing when you fall out of your chair and still breathing into your {{buzzword}}.‚Äù"
      ]
    },
    {
      key: "game-show",
      title: "Recovery Game Show Madness",
      meta: "Points don‚Äôt matter ‚Ä¢ buzzers definitely do",
      paragraphs: [
        "‚ÄúWelcome to Recovery Game Show!‚Äù announced {{staff1}}, waving a {{funny_object}} as a microphone. {{patient1}} jumped up, shouting, ‚ÄúI‚Äôll take {{buzzword}} for 500 points!‚Äù {{patient2}} buzzed in early with a {{funny_object}} they insisted was their personal game-show button. {{patient3}} whispered their strategy to {{staff2}}, who looked equally confused but excited.",
        "The first question was: ‚ÄúName three {{plural_noun}} you can use instead of {{bad_habit}}.‚Äù {{patient1}} answered with ‚Äú{{funny_object}},‚Äù which earned zero points but maximum laughter. {{patient2}} tried to say {{plural_noun}}, but accidentally blurted out their {{adjective}} childhood nickname. {{patient3}} shouted ‚Äú{{catchphrase}}!‚Äù so loudly that {{staff1}} gave them points just to move the game forward. {{staff2}} cheered, scribbling down scores that made no sense.",
        "By round two, the competition got wild. {{patient1}} chose ‚ÄúRelapse Prevention‚Äù and had to act out {{verb_ing}} while holding {{funny_object}}. {{patient2}} demanded a double round on ‚Äú{{buzzword}}‚Äù but instead got asked about {{plural_noun}}. {{patient3}} decided they were the new host, stealing the {{object}} and declaring everyone winners. {{staff1}} tried to protest, but {{staff2}} was already handing out fake prizes made of {{plural_noun}}.",
        "The finale came when everyone spun the ‚ÄúWheel of {{buzzword}},‚Äù which landed on ‚Äú{{funny_object}} challenge.‚Äù The entire group had to chant ‚Äú{{catchphrase}}!‚Äù while doing {{verb_ing}} at the same time. The affirmation became: ‚ÄúRecovery is like a game show‚Äîsometimes you win, sometimes you lose, but you always leave with {{buzzword}}.‚Äù"
      ]
    },
    {
      key: "field-trip",
      title: "Field Trip Fiasco",
      meta: "Roadside coping skills ‚Ä¢ memorable mishaps",
      paragraphs: [
        "The day started with excitement as the van pulled up for the big recovery field trip. {{patient1}} climbed in carrying {{funny_object}}, while {{patient2}} insisted on sitting next to {{staff1}} to talk about their {{buzzword}}. {{patient3}} sat in the back with {{staff2}}, loudly eating {{plural_noun}} and dropping crumbs everywhere. The mood was light until the van broke down in front of {{location}}.",
        "‚ÄúDon‚Äôt panic, let‚Äôs just use our {{buzzword}},‚Äù said {{staff1}}, but {{patient1}} was already {{verb_ing}} on the side of the road. {{patient2}} declared it was a test from their {{higher_power}}, while {{patient3}} shouted ‚Äú{{catchphrase}}!‚Äù at passing cars. {{staff2}} pulled out a {{funny_object}} and claimed they could fix the engine with it, which made everyone laugh until they realized they might actually try.",
        "The group tried to pass the time by playing ‚ÄúI Spy,‚Äù but {{patient1}} only saw {{plural_noun}}, {{patient2}} kept yelling ‚Äú{{buzzword}}!‚Äù at everything, and {{patient3}} insisted the only thing worth spying was {{funny_object}}. {{staff1}} suggested journaling, but no one had pens, so {{staff2}} offered to carve affirmations into {{object}} with their car keys.",
        "Eventually, roadside assistance arrived, but not before the entire group had invented a new coping skill called ‚Äú{{funny_recovery_concept}}.‚Äù They agreed it involved {{verb_ing}} loudly until someone shouted ‚Äú{{catchphrase}}!‚Äù The field trip ended back at the facility with everyone declaring it the most memorable outing since {{funny_event}}. The new affirmation became: ‚ÄúWhen the van breaks down, let your {{buzzword}} drive you home.‚Äù"
      ]
    }
  ];

  // ---------- Placeholder Metadata ----------
  // Map placeholders -> label + suggestion function
  const fields = {
    patient1: { label: "Patient 1 name", suggest: () => rand(pools.patientNames) },
    patient2: { label: "Patient 2 name", suggest: () => rand(pools.patientNames) },
    patient3: { label: "Patient 3 name", suggest: () => rand(pools.patientNames) },
    staff1: { label: "Staff 1 name", suggest: () => rand(pools.staffNames) },
    staff2: { label: "Staff 2 name", suggest: () => rand(pools.staffNames) },
    buzzword: { label: "Buzzword / concept", suggest: () => rand(pools.buzzword) },
    recovery_concept: { label: "Recovery concept", suggest: () => rand(pools.buzzword) },
    catchphrase: { label: "Catchphrase (group chant)", suggest: () => rand(pools.catchphrase) },
    funny_object: { label: "Funny object", suggest: () => rand(pools.funnyObject) },
    plural_noun: { label: "Plural noun", suggest: () => rand(pools.pluralNoun) },
    object: { label: "Object", suggest: () => rand(pools.object) },
    animal: { label: "Animal", suggest: () => rand(pools.animal) },
    funny_liquid: { label: "Funny liquid", suggest: () => rand(pools.funnyLiquid) },
    drink: { label: "Drink", suggest: () => rand(pools.drink) },
    location: { label: "Location (nearby)", suggest: () => rand(pools.location) },
    color: { label: "Funny color", suggest: () => rand(pools.color) },
    funny_song: { label: "Funny song / sound", suggest: () => rand(pools.funnySong) },
    weird_food: { label: "Weird food / combo", suggest: () => rand(pools.food) },
    verb_ing: { label: "Verb ending in -ing", suggest: () => rand(pools.verbIng) },
    verb: { label: "Verb", suggest: () => rand(pools.verb) },
    body_part: { label: "Body part", suggest: () => rand(pools.bodyPart) },
    adjective: { label: "Adjective", suggest: () => rand(pools.adjective) },
    phrase: { label: "Funny phrase", suggest: () => rand(pools.phrase) },
    noun: { label: "Noun (singular)", suggest: () => rand(pools.object) },
    higher_power: { label: "Higher power (funny title)", suggest: () => "Higher Power of " + rand(pools.object) },
    bad_habit: { label: "Bad habit (e.g., doomscrolling)", suggest: () => "doomscrolling" },
    funny_event: { label: "Funny event", suggest: () => "the Great Glitter Spill" },
    funny_recovery_concept: { label: "Funny recovery concept", suggest: () => "Affirmation Karaoke" }
  };

  // Chips with common suggestions
  const chipList = [
    ...pools.buzzword.slice(0,8),
    ...pools.catchphrase.slice(0,4),
    "urge surfing","values in action","radical acceptance","opposite action","anchor breath","grounding list","gratitude rampage"
  ];

  // ---------- Render Story Options ----------
  const storySel = $("#story");
  stories.forEach((s,i)=> storySel.appendChild(h("option",{value:i},`${i+1}. ${s.title}`)));
  storySel.addEventListener("change", renderForm);
  storySel.value = 0;

  const inputsWrap = $("#inputs");
  const chipsWrap = $("#chips");

  chipList.forEach(txt => chipsWrap.appendChild(h("span",{class:"chip"}, txt)));

  function collectPlaceholders(paragraphs){
    const set = new Set();
    const re = /{{(.*?)}}/g;
    paragraphs.forEach(p => {
      let m; while ((m = re.exec(p))){ set.add(m[1]); }
    });
    return Array.from(set);
  }

  function renderForm(){
    const s = stories[storySel.value|0];
    $("#storyTitle").textContent = s.title;
    $("#storyMeta").textContent = s.meta;
    inputsWrap.innerHTML = "";
    const keys = collectPlaceholders(s.paragraphs);

    keys.forEach(k => {
      const meta = fields[k] || { label: toTitle(k), suggest: () => "" };
      const id = "fld_"+k;
      const row = h("div",{class:"input-row"},
        h("label",{for:id}, meta.label),
        h("input",{id, type:"text", placeholder: "(type here)"}),
        h("button",{class:"ghost", title:"Suggest value", onclick: () => { $('#'+id).value = meta.suggest(); }}, "üéØ")
      );
      inputsWrap.appendChild(row);
    });
    // Focus the first field
    const first = inputsWrap.querySelector("input"); if (first) first.focus();
    $("#outTitle").textContent = "Your Story Will Appear Here";
    $("#outBody").innerHTML = "";
  }

  renderForm();

  // Buttons
  $("#randomBtn").addEventListener("click", () => {
    inputsWrap.querySelectorAll("input").forEach(inp => {
      const key = inp.id.replace("fld_","");
      const meta = fields[key];
      inp.value = meta ? meta.suggest() : "";
    });
  });

  $("#clearBtn").addEventListener("click", () => {
    inputsWrap.querySelectorAll("input").forEach(inp => inp.value="");
    $("#outTitle").textContent = "Your Story Will Appear Here";
    $("#outBody").innerHTML = "";
  });

  $("#generateBtn").addEventListener("click", () => {
    const s = stories[storySel.value|0];
    const values = {};
    inputsWrap.querySelectorAll("input").forEach(inp => {
      const key = inp.id.replace("fld_","");
      values[key] = inp.value || (fields[key] ? fields[key].suggest() : "");
    });
    // Replace
    const re = /{{(.*?)}}/g;
    const paras = s.paragraphs.map(p => p.replace(re, (_,k)=> values[k] ?? ""));
    $("#outTitle").textContent = s.title;
    $("#outBody").innerHTML = "";
    paras.forEach(pa => $("#outBody").appendChild(h("div",{class:"para"}, pa)));
    // Smooth scroll
    $("#outBody").scrollIntoView({behavior:"smooth"});
  });

  $("#copyBtn").addEventListener("click", async () => {
    const title = $("#outTitle").textContent.trim();
    const paras = Array.from(document.querySelectorAll("#outBody .para")).map(p => p.textContent.trim());
    if (!title || paras.length === 0){
      alert("Generate a story first, then copy."); return;
    }
    const payload = `# ${title}\n\n` + paras.map(p => p + "\n").join("\n");
    try {
      await navigator.clipboard.writeText(payload);
      alert("Story copied to clipboard!");
    } catch(e){
      // Fallback: select text
      const sel = window.getSelection();
      const range = document.createRange();
      const out = $("#outBody");
      range.selectNodeContents(out);
      sel.removeAllRanges();
      sel.addRange(range);
      alert("Select & copy (Ctrl/Cmd+C).");
    }
  });
  </script>
</body>
</html>
